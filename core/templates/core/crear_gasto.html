{% extends 'core/base.html' %}
{% block content %}
<div class="container mt-4">
    <h2>Nuevo Gasto</h2>
    <form method="post">
        {% csrf_token %}
        <div class="mb-3">
            <label for="descripcion" class="form-label">Descripción</label>
            <input type="text" class="form-control" id="descripcion" name="descripcion" required>
        </div>
        <div class="mb-3">
            <label for="monto_total" class="form-label">Monto Total (€)</label>
            <input type="number" step="0.01" class="form-control" id="monto_total" name="monto_total" required>
        </div>
        <div class="mb-3">
            <label for="categoria" class="form-label">Categoría</label>
            <select class="form-select" id="categoria" name="categoria" required>
                <option value="">Selecciona una categoría</option>
                {#
                    Se ofrece la lista de categorías como nombres legibles. La
                    vista ``crear_gasto`` se encarga de devolver este mismo
                    listado para mantener la coherencia con el modelo ``Gasto``.
                    Se ha añadido «Compras piso» a la lista.
                #}
                {% for categoria in categorias %}
                    <option value="{{ categoria }}">{{ categoria }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="mb-3">
            <label for="fecha" class="form-label">Fecha</label>
            <input type="date" class="form-control" id="fecha" name="fecha" required>
        </div>
        <div class="mb-3">
            <label for="pagado_por" class="form-label">Pagado por</label>
            <select class="form-select" id="pagado_por" name="pagado_por" required>
                <option value="">Selecciona quién pagó</option>
                {% for usuario in usuarios %}
                    <option value="{{ usuario.id }}" {% if usuario == request.user %}selected{% endif %}>{{ usuario.username }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="mb-3">
            <label for="fondo" class="form-label">Descontar de fondo (opcional)</label>
            <select class="form-select" id="fondo" name="fondo">
                <option value="">No descontar de ningún fondo</option>
                {% for fondo in fondos %}
                    <option value="{{ fondo.id }}" {% if fondo.id|stringformat:"s" == fondo_seleccionado %}selected{% endif %}>
                        {{ fondo.get_tipo_display }} (Saldo: {{ fondo.saldo }}€)
                    </option>
                {% endfor %}
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Guardar Gasto</button>
        <a href="{% url 'panel_gastos' %}" class="btn btn-secondary">Cancelar</a>
    </form>
</div>
{% endblock %}