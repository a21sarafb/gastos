{% extends 'core/base.html' %} 
{% block content %}
<div class="container mt-4 fade-in">
  <h2 class="mb-4"><i class="bi bi-graph-up-arrow"></i> Resumen de Finanzas</h2>

  <div class="row g-4">
    <div class="col-md-6">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title"><i class="bi bi-pie-chart"></i> Gastos por categoría (mes actual)</h5>
          <canvas id="graficoCategorias" height="200"></canvas>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title"><i class="bi bi-bar-chart-line"></i> Gastos totales últimos meses</h5>
          <canvas id="graficoMeses" height="200"></canvas>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title"><i class="bi bi-basket"></i> Supermercados (mes actual)</h5>
          <canvas id="graficoSupermercados" height="200"></canvas>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title"><i class="bi bi-table"></i> Totales por categoría</h5>
          <table class="table table-hover table-bordered align-middle">
            <thead class="table-light">
              <tr>
                <th>Categoría</th>
                <th>Total (€)</th>
              </tr>
            </thead>
            <tbody>
              {% for item in tabla_categoria %}
              <tr>
                <td>{{ item.nombre }}</td>
                <td>{{ item.total }}</td>
              </tr>
              {% endfor %}
              <tr class="table-info">
                <td><strong>Total</strong></td>
                <td><strong>{{ total_general }}</strong></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} 

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  Chart.defaults.font.family = 'Inter';
  Chart.defaults.color = '#444';

  const pieColors = ['#FFCDD2', '#FFE0B2', '#C8E6C9', '#BBDEFB', '#E1BEE7', '#F8BBD0'];

  new Chart(document.getElementById('graficoCategorias'), {
    type: 'pie',
    data: {
      labels: {{ labels_categoria|safe }},
      datasets: [{
        data: {{ data_categoria|safe }},
        backgroundColor: pieColors,
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      animation: { duration: 800, easing: 'easeOutQuart' },
      plugins: { legend: { position: 'bottom' } }
    }
  });

  new Chart(document.getElementById('graficoMeses'), {
    type: 'bar',
    data: {
      labels: {{ labels_mes|safe }},
      datasets: [{
        label: 'Total Gastos',
        data: {{ data_mes|safe }},
        backgroundColor: '#F8BBD0',
        borderColor: '#F48FB1',
        borderWidth: 1,
        borderRadius: 8,
        borderSkipped: false
      }]
    },
    options: {
      responsive: true,
      animation: {
        duration: 1000,
        easing: 'easeOutQuart',
        delay: (ctx) => ctx.dataIndex * 100
      },
      plugins: { legend: { display: false } },
      scales: {
        y: {
          beginAtZero: true,
          grid: { color: 'rgba(0,0,0,0.05)' }
        },
        x: { grid: { display: false } }
      }
    }
  });

  const labelsSuper = {{ labels_super|safe }};
  const dataSuper = {{ data_super|safe }};
  const colorsSuper = ['#80DEEA', '#FFE082', '#A5D6A7', '#FFAB91', '#CE93D8', '#FFCDD2', '#F0F4C3', '#B39DDB'];
  const superColors = labelsSuper.map((_, i) => colorsSuper[i % colorsSuper.length]);

  new Chart(document.getElementById('graficoSupermercados'), {
    type: 'pie',
    data: {
      labels: labelsSuper,
      datasets: [{ data: dataSuper, backgroundColor: superColors, borderWidth: 1 }]
    },
    options: {
      responsive: true,
      animation: { duration: 800, easing: 'easeOutQuart' },
      plugins: { legend: { position: 'bottom' } }
    }
  });
</script>
{% endblock %}